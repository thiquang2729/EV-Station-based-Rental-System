events {}

http {
  # Auth service (máy bạn của bạn)
  upstream auth_svc {
    server 192.168.1.120:8000;  # IP LAN + port thật
  }

  # Rental service (local)
  upstream rental_svc {
    server rental-svc:3002;
  }

  # Fleet service (local)
  upstream fleet_svc {
    server fleet-svc:3003;
  }

  # Admin service (local)
  upstream admin_svc {
    server admin-svc:3001;
  }

  server {
    listen 80;

    # Auth service (bạn của bạn)
    location /auth/ {
      proxy_pass http://auth_svc/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      add_header Access-Control-Allow-Origin *;
    }

    # Rental service
    location /rental/ {
      proxy_pass http://rental_svc/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      add_header Access-Control-Allow-Origin *;
    }

    # Fleet service
    location /fleet/ {
      proxy_pass http://fleet_svc/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      add_header Access-Control-Allow-Origin *;
    }

    # Admin service
    location /admin/ {
      proxy_pass http://admin_svc/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      add_header Access-Control-Allow-Origin *;
    }
  }
}
