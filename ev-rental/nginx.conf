events {}

http {
  upstream admin_svc {
    server admin-svc:3001;
  }

  upstream rental_svc {
    server rental-svc:3002;
  }

  upstream fleet_svc {
    server fleet-svc:3003;
  }

  server {
    listen 80;

    # Health for admin-svc (service exposes /health)
    location = /admin/health {
      proxy_pass http://admin_svc/health;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_read_timeout 60s;
    }

    # Preserve /admin prefix for other endpoints (service exposes /admin/..)
    location /admin/ {
      proxy_pass http://admin_svc;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_read_timeout 60s;
    }

    location /rental/ {
      proxy_pass http://rental_svc/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_read_timeout 60s;
    }

    location /fleet/ {
      proxy_pass http://fleet_svc/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_http_version 1.1;
      proxy_read_timeout 60s;
    }
  }
}
